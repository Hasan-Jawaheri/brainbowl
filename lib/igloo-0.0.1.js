var VecN=VecN||function(){};VecN.FIELDS="xyzwabcdefghijklmnopqrstuv".split("");VecN.make=function(c){if(c>VecN.FIELDS.length){throw new Error("VecN limited to "+VecN.FIELDS.length)}function d(q,i){var p=q.slice(0);p.push(i);p.unshift(null);var n=Function.bind.apply(Function,p);return new n()}var k=VecN.FIELDS.slice(0,c);var e=d(k,k.map(function(i){return"this."+i+" = "+i+";"}).join("\n"));e.prototype=Object.create(VecN.prototype);e.prototype.length=c;e.prototype.VecN=this;e.prototype.toString=d([],'return "[Vec'+c+' (" + '+k.map(function(i){return"this."+i}).join(' + ", " + ')+' + ")]";');function h(n,i){i=i||"this.constructor";return"return new "+i+"("+k.map(n).join(", ")+");"}function l(i){return d(["vec"],h(function(n){return"this."+n+" "+i+" vec."+n}))}e.prototype.add=l("+");e.prototype.subtract=l("-");e.prototype.multiply=l("*");e.prototype.divide=l("/");function j(i){return d(["scalar"],h(function(n){return"this."+n+" "+i+" scalar"}))}e.prototype.fadd=j("+");e.prototype.fsubtract=j("-");e.prototype.fmultiply=j("*");e.prototype.fdivide=j("/");e.prototype.magnitude=d([],"return Math.sqrt("+k.map(function(i){return"this."+i+" * this."+i}).join(" + ")+");");function o(i,n){n=n||[];return d(n,h(function(q){var p=n.slice(0);p.unshift("this."+q);return i+"("+p.join(", ")+")"}))}e.prototype.floor=o("Math.floor");e.prototype.ceil=o("Math.ceil");e.prototype.abs=o("Math.abs");e.prototype.negate=o("-1 * ");e.prototype.pow=o("Math.pow",["expt"]);e.prototype.pow2=d([],h(function(i){return"this."+i+" * this."+i}));e.prototype.pow3=d([],h(function(i){return"this."+i+" * this."+i+" * this."+i}));e.prototype.product=d([],"return "+k.map(function(i){return"this."+i}).join(" * ")+";");e.prototype.sum=d([],"return "+k.map(function(i){return"this."+i}).join(" + ")+";");e.prototype.normalize=function g(){return this.divide(this.magnitude())};e.prototype.dot=function a(i){return this.multiply(i).sum()};e.prototype.toArray=d([],"return ["+k.map(function(i){return"this."+i}).join(", ")+"]");function m(i){var n=i.map(function(p){return"this."+p}).join(", ");Object.defineProperty(e.prototype,i.join(""),{get:new Function("return new this.VecN.Vec"+i.length+"("+n+");")})}function b(i,n){k.forEach(function(p){i.push(p);if(n===1){m(i)}else{b(i,n-1)}i.pop()})}if(c<=6){for(var f=2;f<=c;f++){b([],f)}}e.random=d([],h(function(){return"Math.random()"},"this"));return e};(10);VecN.convenience=function(a){return function(){var d=[];for(var f=0;f<arguments.length;f++){var c=arguments[f];if(c.toArray){d.push.apply(d,c.toArray())}else{d.push(c)}}var b=VecN["Vec"+a];var e=Object.create(b.prototype);b.apply(e,d);return e}};VecN.Vec2=VecN.make(2);VecN.Vec3=VecN.make(3);VecN.Vec4=VecN.make(4);var vec2=VecN.convenience(2);var vec3=VecN.convenience(3);var vec4=VecN.convenience(4);var Igloo=Igloo||{};Igloo.fetch=function(a,c){var b=new XMLHttpRequest();b.open("GET",a,Boolean(c));if(c!=null){b.onload=function(){c(b.responseText)}}b.send();return b.responseText};Igloo.getContext=function(b,a){var d;try{d=b.getContext("webgl")||b.getContext("experimental-webgl")}catch(c){d=null}if(d==null&&a){throw new Error("Could not create WebGL context.")}else{return d}};Igloo.Program=function(c,b,a){if(c instanceof HTMLCanvasElement){c=Igloo.getContext(c,true)}this.gl=c;this.program=c.createProgram();c.attachShader(this.program,this.makeShader(c.VERTEX_SHADER,b));c.attachShader(this.program,this.makeShader(c.FRAGMENT_SHADER,a));c.linkProgram(this.program);if(!c.getProgramParameter(this.program,c.LINK_STATUS)){throw new Error(c.getProgramInfoLog(this.program))}this.vars={}};Igloo.Program.prototype.makeShader=function(b,a){var d=this.gl;var c=d.createShader(b);d.shaderSource(c,Igloo.fetch(a));d.compileShader(c);if(d.getShaderParameter(c,d.COMPILE_STATUS)){return c}else{throw new Error(d.getShaderInfoLog(c))}};Igloo.Program.prototype.use=function(){this.gl.useProgram(this.program);return this};Igloo.Program.prototype.uniform=function(b,d,c){if(d==null){this.vars[b]=this.gl.getUniformLocation(this.program,b)}else{if(this.vars[b]==null){this.uniform(b)}var a=this.vars[b];if(d instanceof VecN){switch(d.length){case 2:if(c){this.gl.uniform2i(a,d.x,d.y)}else{this.gl.uniform2f(a,d.x,d.y)}break;case 3:if(c){this.gl.uniform3i(a,d.x,d.y,d.z)}else{this.gl.uniform3f(a,d.x,d.y,d.z)}break;case 4:if(c){this.gl.uniform4i(a,d.x,d.y,d.z,d.w)}else{this.gl.uniform4f(a,d.x,d.y,d.z,d.w)}break;default:throw new Error("Invalid vector length")}}else{if(c){this.gl.uniform1i(a,d)}else{this.gl.uniform1f(a,d)}}}return this};Igloo.Program.prototype.attrib=function(a,c,b){if(c==null){this.vars[a]=this.gl.getAttribLocation(this.program,a);this.gl.enableVertexAttribArray(this.vars.position)}else{if(this.vars[a]==null){this.attrib(a)}var d=this.gl;if(c instanceof Igloo.Buffer){c.bind()}else{d.bindBuffer(d.ARRAY_BUFFER,c)}d.vertexAttribPointer(this.vars[a],b,d.FLOAT,false,0,0)}return this};Igloo.Program.prototype.draw=function(b,a){this.gl.drawArrays(b,0,a);if(this.gl.getError()!==this.gl.NO_ERROR){throw new Error("WebGL rendering error")}return this};Igloo.Buffer=function(c,b,a){if(c instanceof HTMLCanvasElement){c=Igloo.getContext(c,true)}a=a==null?c.STATIC_DRAW:a;this.gl=c;this.buffer=c.createBuffer();this.size=-1;if(b!=null){this.update(b,a)}};Igloo.Buffer.prototype.bind=function(){var a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,this.buffer);return this};Igloo.Buffer.prototype.update=function(b,a){var c=this.gl;a=a==null?c.STREAM_DRAW:a;this.bind();if(this.size!==b.byteLength){c.bufferData(c.ARRAY_BUFFER,b,a);this.size=b.byteLength}else{c.bufferSubData(c.ARRAY_BUFFER,0,b)}return this};